<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Repositorio Policial - Ayuntamiento</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --primary: #003366; --secondary: #004488; --bg: #f4f7f6; --text: #333; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 30px; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .search-box input { width: 90%; padding: 12px; border: 1px solid #ccc; border-radius: 20px; font-size: 16px; margin-top: 10px;}
        .card { background: white; margin-bottom: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); overflow: hidden; border-left: 5px solid var(--primary); }
        .card-header { padding: 15px 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .card-header:hover { background: #f9f9f9; }
        .card-header h2 { margin: 0; font-size: 1.1rem; color: var(--primary); }
        .meta { font-size: 0.8em; color: #666; }
        .card-body { display: none; padding: 0; border-top: 1px solid #eee; }
        .card.active .card-body { display: block; }
        .tabs { display: flex; background: #eee; }
        .tab-btn { flex: 1; padding: 12px; border: none; background: #eee; cursor: pointer; font-weight: 600; color: #555; }
        .tab-btn.active { background: white; border-bottom: 3px solid var(--secondary); color: var(--secondary); }
        .tab-content { display: none; padding: 20px; }
        .tab-content.active { display: block; }
        .flashcard-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 10px; }
        .fc { border: 1px solid #ddd; padding: 15px; border-radius: 5px; cursor: pointer; background: #fffbe6; transition: 0.2s; }
        .fc:hover { transform: scale(1.02); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .fc-back { display: none; color: #006600; font-weight: bold; margin-top: 10px; border-top: 1px solid #ccc; padding-top: 5px;}
        .fc.flipped .fc-back { display: block; }
        .quiz-item { margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .quiz-opt { padding: 5px 10px; margin: 2px 0; background: #f0f0f0; border-radius: 4px; cursor: pointer; }
        .quiz-opt:hover { background: #e0e0e0; }
        .btn-download { display: inline-block; padding: 10px 20px; background: var(--secondary); color: white; text-decoration: none; border-radius: 5px; margin-top: 10px; }
        .error { color: red; padding: 20px; text-align: center; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1><i class="fas fa-shield-alt"></i> Normativa Policial</h1>
        <div class="search-box">
            <input type="text" id="search" placeholder="üîç Buscar norma, concepto, infracci√≥n..." onkeyup="filtrar()">
        </div>
    </header>
    <div id="contenido">Cargando base de datos...</div>
</div>

<script>
    fetch('database.json?v=' + new Date().getTime())
    .then(r => r.json())
    .then(data => {
        const div = document.getElementById('contenido');
        div.innerHTML = '';
        data.forEach((item, i) => {
            let fcHtml = item.flashcards.map(f => `<div class="fc" onclick="this.classList.toggle('flipped')"><strong>‚ùì ${f.front}</strong><div class="fc-back">üí° ${f.back}</div></div>`).join('');
            let testHtml = item.test.map(t => {
                let opts = t.respuestas.map((r, idx) => `<div class="quiz-opt" onclick="check(this, ${idx === t.correcta})">${r}</div>`).join('');
                return `<div class="quiz-item"><p><strong>${t.pregunta}</strong></p>${opts}</div>`;
            }).join('');

            div.innerHTML += `
            <div class="card">
                <div class="card-header" onclick="this.parentElement.classList.toggle('active')">
                    <div><h2>${item.titulo}</h2><div class="meta">${item.meta}</div></div>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="card-body">
                    <div class="tabs">
                        <button class="tab-btn active" onclick="openTab(event, 'doc-${i}')">Documento</button>
                        <button class="tab-btn" onclick="openTab(event, 'fc-${i}')">Estudio (${item.flashcards.length})</button>
                        <button class="tab-btn" onclick="openTab(event, 'qz-${i}')">Test</button>
                    </div>
                    <div id="doc-${i}" class="tab-content active">
                        <div style="background:#eef; padding:10px; border-radius:5px; margin-bottom:15px;"><strong>Resumen:</strong> ${item.resumen}</div>
                        ${item.contenido_html}
                        <hr>
                        <h4>Archivos:</h4>
                        ${item.audio_url ? `<p>üéß Audio: <audio controls src="${item.audio_url}" style="vertical-align:middle; width:80%"></audio></p>` : ''}
                        ${item.link_fuente ? `<a href="${item.link_fuente}" class="btn-download" target="_blank">üìÑ Descargar PDF Oficial</a>` : ''}
                    </div>
                    <div id="fc-${i}" class="tab-content"><div class="flashcard-grid">${fcHtml}</div></div>
                    <div id="qz-${i}" class="tab-content">${testHtml}</div>
                </div>
            </div>`;
        });
    })
    .catch(e => document.getElementById('contenido').innerHTML = '<div class="error">‚ö†Ô∏è No se encuentra el archivo <strong>database.json</strong> o tiene errores de formato.</div>');

    function openTab(e, id) {
        let p = e.target.closest('.card-body');
        p.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        p.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        e.target.classList.add('active');
    }
    function check(el, ok) {
        el.style.background = ok ? '#d4edda' : '#f8d7da';
        el.innerHTML += ok ? ' ‚úÖ' : ' ‚ùå';
    }
    function filtrar() {
        let q = document.getElementById('search').value.toLowerCase();
        document.querySelectorAll('.card').forEach(c => c.style.display = c.innerText.toLowerCase().includes(q) ? 'block' : 'none');
    }
</script>
</body>
</html>
